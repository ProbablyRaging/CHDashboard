<%- include('../partials/header') -%>
<%- include('../partials/topbar') -%>
<%- include('../partials/container') -%>

<script>
    $(function () {
        $("td[colspan=3]").find("p").hide();
        $("td[colspan=3]").find("li").hide();
        $("table").click(function (event) {
            event.stopPropagation();
            var $target = $(event.target);
            $target.closest("tr").next().find("p").slideToggle(150);
            $target.closest("tr").next().find("li").slideToggle(150);
        });
    });
</script>
<style>
    .acp-user-search {
        width: 300px;
        height: 42px;
        padding: 5px;
        margin-bottom: 20px;
        color: var(--text) !important;
        background: var(--accent);
        border: var(--border-l);
        border-radius: 6px;
        transition: background 250ms ease-in-out, color 250ms ease-in-out, border 250ms ease-in-out;
    }

    .acp-user-table {
        width: 70vw;
        margin-bottom: 10px;
    }

    .acp-user-table thead {
        color: var(--text) !important;
        font-weight: var(--w-5);
        transition: background 250ms ease-in-out, color 250ms ease-in-out, border 250ms ease-in-out;
    }

    .acp-user-table .t-user {
        font-weight: var(--w-5);
    }

    .acp-user-table tbody {
        color: var(--text-alt);
        background: var(--accent);
        border-bottom: var(--border-l);
        border-right: var(--border-l);
        border-left: var(--border-l);
        transition: background 250ms ease-in-out, color 250ms ease-in-out, border 250ms ease-in-out;
    }

    .acp-user-table td {
        padding: 6px;
        transition: background 250ms ease-in-out, color 250ms ease-in-out, border 250ms ease-in-out;
    }

    .acp-user-table th {
        background: var(--bg-o);
        padding: 6px;
        border: var(--border-l);
        transition: background 250ms ease-in-out, color 250ms ease-in-out, border 250ms ease-in-out;
    }

    .acp-user-table tr:hover {
        background: var(--bg-o);
    }

    .acp-user-table thead>tr>th:last-child {
        display: none;
    }

    .ul-roles {
        margin-top: -22px;
    }

    .li-roles {
        list-style: none;
        text-indent: 50px;
    }
</style>

<input class="acp-user-search" type="text" id="acp-user-search" onkeyup="userSearch()" placeholder="Filter by value">

<div class="tgrid" id="tgrid">
    <% for (const data of results) { %>
    <% const {dataLog} = data; %>
    <table class="acp-user-table" id="<%= data.username %>">
        <tbody>
            <tr>
                <td>
                    <p class="t-user"><%= data.username %> </p>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <p>
                        <strong>ID:</strong>
                        <%= data.userId %>
                    </p>
                    <p>
                        <strong>Discriminator:</strong>
                        #<%= data.discriminator %>
                    </p>
                    <p>
                        <strong>Username:</strong>
                        <%= data.username %>#<%= data.discriminator %>
                    </p>
                    <p>
                        <strong>Avatar:</strong>
                        <a href="https://cdn.discordapp.com/avatars/<%= data.userId %>/<%= data.avatar %>.webp"
                            target="_blank">https://cdn.discordapp.com/avatars/<%= data.userId %>/<%= data.avatar %>.webp</a>
                    </p>
                    <p>
                        <strong>Roles:</strong>
                    <ul class="ul-roles">
                        <% data.roles.forEach(role => { %>
                        <li class="li-roles">
                            <%= role %>
                        </li>
                        <% }) %>
                    </ul>
                    </p>
                    <p>
                        <strong>Last Visit:</strong>
                        <%= new Date(dataLog[dataLog?.length - 1]?.timestamp).toLocaleDateString("en-US", { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %>
                        <i>(IP Address: <%= dataLog[dataLog?.length - 1]?.ip %>)</i>
                    </p>
                </td>
            </tr>
        </tbody>
    </table>
    <% } %>
</div>

<%- include('../partials/footer') -%>